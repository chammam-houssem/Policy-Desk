<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Article 1 - The Future of Renewable Energy</title>
  <link rel="stylesheet" href="../styles.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <style>
    #chartContainer { width: 80%; max-width: 600px; margin: 20px auto; }
    #map { height: 400px; width: 80%; max-width: 600px; margin: 20px auto; }
  </style>
</head>
<body>
  <article>
    <img class="article-image" src="../Images/image1.jpg" alt="Renewable Energy">
    <h1 class="article-title">The Future of Renewable Energy</h1>
    <p class="article-description"><mark>Exploring how renewable energy sources are shaping the future of global power generation and sustainability.</mark></p>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque vitae velit ex. Mauris dapibus risus quis suscipit vulputate.</p>
  </article>

  <div style="text-align:center;margin-top:40px;">
    <label for="yearSelect">Select year: </label>
    <select id="yearSelect"></select>
  </div>
  <div id="chartContainer">
    <canvas id="gdpChart"></canvas>
  </div>
  <div id="map"></div>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      Papa.parse('../Country_Data.csv', {
        download: true,
        header: true,
        complete: (results) => init(results.data.filter(r => r.Country))
      });
    });

    let chart, map, allData;

    function init(data) {
      allData = data;
      const years = [...new Set(data.map(d => d.Year))];
      const yearSelect = document.getElementById('yearSelect');
      years.forEach(y => {
        const opt = document.createElement('option');
        opt.value = y; opt.textContent = y; yearSelect.appendChild(opt);
      });
      yearSelect.value = years[0];
      initChart(years[0]);
      initMap(years[0]);
      yearSelect.addEventListener('change', () => {
        updateChart(yearSelect.value);
        updateMap(yearSelect.value);
      });
    }

    function getMedData(year) {
      return allData.filter(d => d.Mediterranean === '1' && d.Year === year);
    }

    function initChart(year) {
      const med = getMedData(year);
      const ctx = document.getElementById('gdpChart').getContext('2d');
      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: med.map(d => d.Country),
          datasets: [{
            label: 'GDP (B USD)',
            data: med.map(d => Number(d.GDP)),
            backgroundColor: '#36a853'
          }]
        },
        options: {responsive:true}
      });
    }

    function updateChart(year) {
      const med = getMedData(year);
      chart.data.labels = med.map(d => d.Country);
      chart.data.datasets[0].data = med.map(d => Number(d.GDP));
      chart.update();
    }

    function initMap(year) {
      map = L.map('map').setView([38,13], 4);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
      }).addTo(map);
      updateMap(year);
    }

    function updateMap(year) {
      const med = getMedData(year);
      map.eachLayer(l => { if(l instanceof L.Marker) map.removeLayer(l); });
      med.forEach(d => {
        const lat = parseFloat(d.Latitude);
        const lon = parseFloat(d.Longitude);
        if(!isNaN(lat) && !isNaN(lon)) {
          L.marker([lat,lon]).addTo(map).bindPopup(`${d.Country}: GDP ${d.GDP}`);
        }
      });
    }
  </script>
</body>
</html>
